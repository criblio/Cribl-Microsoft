# Version 1.0.3 - Subscription Management & Configuration Improvements
**Release Date:** 2024/09/24

## Overview
Version 1.0.3 introduces automatic Azure subscription management and simplifies configuration by consolidating resource group settings and removing the need for client secret management in configuration files. This release improves user experience and reduces configuration complexity.

## Critical Bug Fixes

### Azure Subscription Context Management
- **Added automatic subscription context setting** from `azure-parameters.json` configuration
- **Fixed subscription context issues** where scripts would run against wrong subscription
- **Enhanced error handling** for subscription context failures with graceful fallback
- **Added validation** for subscription ID parameter in configuration validation
- **Improved user feedback** with clear messages when subscription context is set

### Configuration Parameter Consolidation
- **Removed redundant `dceResourceGroupName` parameter** from azure-parameters.json
- **Consolidated DCE and DCR resource group** to use single `resourceGroupName` parameter
- **Updated all scripts** to use unified resource group configuration
- **Fixed template generation** to use correct resource group for DCE resources
- **Simplified deployment configuration** by reducing duplicate parameters

### Client Secret Security Enhancement
- **Removed `clientSecret` from configuration files** to improve security
- **Updated Cribl destination generation** to use `<replace me>` placeholder for manual configuration
- **Enhanced security documentation** regarding client secret management
- **Simplified authentication setup** by removing sensitive data from config files
- **Updated all validation logic** to handle placeholder-based client secret approach

## New Features

### Automatic Subscription Management
- **New `subscriptionId` parameter** in azure-parameters.json for automatic context setting
- **Automatic subscription switching** when running DCR automation scripts
- **Subscription validation** as part of configuration validation process
- **Clear feedback messages** when subscription context is successfully set
- **Graceful degradation** if subscription setting fails, with warning messages

### Simplified Configuration
- **Unified resource group management** - single parameter for all Azure resources
- **Reduced configuration complexity** by removing redundant parameters
- **Enhanced configuration validation** with better error messages
- **Improved user guidance** with updated help text and documentation
- **Streamlined parameter structure** for easier setup and maintenance

## Improvements

### Configuration Management
- **Consolidated azure-parameters.json structure** with essential parameters only
- **Enhanced parameter validation** including subscription ID validation
- **Better configuration error messages** with specific field guidance
- **Improved setup documentation** reflecting simplified configuration
- **Updated comments and help text** to reflect new parameter structure

### Security Enhancements
- **Removed sensitive data** from configuration files (client secret)
- **Enhanced client secret handling** with placeholder approach for Cribl destinations
- **Updated security documentation** regarding credential management best practices
- **Improved authentication flow** with clearer separation of concerns
- **Better credential management guidance** in documentation

### User Experience
- **Clearer status displays** showing current subscription and configuration
- **Enhanced validation messages** with specific parameter requirements
- **Better error handling** with actionable error messages
- **Improved setup flow** with streamlined configuration requirements
- **Updated menu displays** showing current subscription context

## Technical Details

### Files Modified
- **`azure-parameters.json`**: Added `subscriptionId`, removed `dceResourceGroupName` and `clientSecret`
- **`Create-TableDCRs.ps1`**: Added automatic subscription context setting, updated resource group handling
- **`Run-DCRAutomation.ps1`**: Enhanced validation logic, updated help text and status displays
- **`Generate-CriblDestinations.ps1`**: Updated client secret handling to use placeholder approach
- **`cribl-parameters.json`**: Updated authentication documentation

### Configuration Changes
#### Before v1.0.3:
```json
{
 "resourceGroupName": "<YOUR-RG-NAME-HERE>",
 "dceResourceGroupName": "<YOUR-DCE-RG-NAME-HERE>",
 "clientSecret": "<YOUR-CLIENT-SECRET-HERE>",
 // ... other parameters
}
```

#### After v1.0.3:
```json
{
 "subscriptionId": "<YOUR-SUBSCRIPTION-ID-HERE>",
 "resourceGroupName": "<YOUR-RG-NAME-HERE>",
 // clientSecret removed - now uses <replace me> placeholder
 // dceResourceGroupName removed - uses resourceGroupName
 // ... other parameters
}
```

### Subscription Management Logic
- **Context validation**: Checks current Azure context before operations
- **Automatic switching**: Sets subscription context from configuration
- **Error handling**: Graceful fallback if subscription setting fails
- **User feedback**: Clear messages about subscription context operations
- **Validation integration**: Subscription ID included in required parameter validation

## Migration Guide

### For Existing Users
1. **Update azure-parameters.json**:
 - Add `"subscriptionId": "<YOUR-SUBSCRIPTION-ID-HERE>"` at the top
 - Remove `"dceResourceGroupName"` parameter (DCEs will use same RG as DCRs)
 - Remove `"clientSecret"` parameter (now handled via placeholder)

2. **Re-export Cribl configurations** to get new placeholder-based client secret handling

3. **Verify subscription context** - scripts will now automatically switch to configured subscription

### Breaking Changes
- **`dceResourceGroupName` parameter removed**: Update any external scripts that reference this parameter
- **`clientSecret` parameter removed**: Update any external scripts that access client secret from config
- **Subscription context**: Scripts now automatically set subscription context from configuration

### Testing Your Setup
```powershell
# Verify updated configuration
.\Run-DCRAutomation.ps1
# Check that subscription context is set correctly
# Verify DCEs are created in same resource group as DCRs
# Confirm Cribl configs use <replace me> placeholder
```

## Validation

### Configuration Validation
- **Subscription ID validation**: Ensures subscription ID is configured before execution
- **Parameter consolidation**: Validates unified resource group configuration
- **Security compliance**: Confirms sensitive data is not stored in configuration files
- **Setup verification**: Enhanced validation messages guide proper configuration

### Functionality Testing
- **Automatic subscription switching**: Verified context setting works with valid subscription IDs
- **Resource group consolidation**: Confirmed DCEs and DCRs deploy to same resource group
- **Client secret placeholders**: Validated Cribl configurations use proper placeholder values
- **Error handling**: Tested graceful fallback when subscription context setting fails

## Best Practices

### Configuration Management
1. **Use organization-specific subscription ID** to ensure resources deploy to correct subscription
2. **Use single resource group** for both DCRs and DCEs to simplify management
3. **Store client secrets securely** outside of configuration files (use Cribl Stream's secure credential storage)
4. **Validate configuration** before running automation scripts

### Security
1. **Never commit client secrets** to version control systems
2. **Use placeholder approach** for sensitive credentials in automated configurations
3. **Configure client secrets directly in Cribl Stream** for better security
4. **Regularly rotate credentials** and update them in Cribl Stream destinations

## System Requirements
No changes from v1.0.2

## Security Notes
- **Enhanced credential security**: Client secrets no longer stored in configuration files
- **Improved secret management**: Placeholder-based approach for Cribl destination credentials
- **Subscription isolation**: Automatic subscription context ensures resources deploy to correct subscription
- **Configuration file security**: Sensitive data removed from version-controlled configuration files

## Known Issues
- **First-time setup**: Users need to manually configure client secrets in Cribl Stream after export
- **Subscription permissions**: Ensure service principal has appropriate permissions on target subscription
- **Legacy configurations**: Existing configurations need manual update to new parameter structure

## Contributors

### This Release
- **Subscription context management** and automatic Azure subscription handling
- **Configuration parameter consolidation** and resource group unification
- **Client secret security enhancements** with placeholder-based approach
- **Enhanced validation and error handling** improvements

### Ongoing Contributors
- **Cam Borgal** - Original DCR table specific templates creation
- **James Pederson** - Direct DCR Templates and Automation script, configuration improvements

## What's Next

Planned improvements for future releases:
- **Enhanced Azure authentication methods** (managed identity support)
- **Bulk subscription management** for multi-tenant scenarios
- **Advanced credential management integration** with Azure Key Vault
- **Configuration template generation** for different deployment scenarios
- **Enhanced monitoring and logging** for subscription context operations

## Support

For issues related to:
- **Subscription context problems**: Verify subscription ID and permissions in azure-parameters.json
- **Configuration migration**: Check parameter structure against new format
- **Client secret setup**: Configure secrets directly in Cribl Stream destinations
- **Resource group consolidation**: Verify DCEs and DCRs deploy to intended resource group

Use the GitHub Issues section for bug reports and feature requests.

---

**Thank you for using Cribl-Microsoft integration tools! This release significantly improves security, simplifies configuration, and ensures proper Azure subscription management.**