# DCR Automation v1.2.0 Release Notes

**Release Date:** November 11, 2025
**Version:** v1.2.0
**Type:** Feature Enhancement

## Interactive DCR/DCE Name Confirmation

### New Feature: Name Confirmation Prompts

This release introduces an interactive confirmation system that allows users to review, accept, or customize DCR and DCE names before deployment.

### Key Features

#### 1. Interactive Name Confirmation
- **Review proposed names** before creating Azure resources
- **Accept, skip, or edit** DCR/DCE names during execution
- **Validation feedback** with character limits and naming rules
- **Smart abbreviation detection** alerts when table names are truncated

#### 2. User-Friendly Edit Mode
When editing a name, users get:
- **Pre-filled suggested name** as a starting point
- **Press Enter to keep** the suggested name
- **Type new name** to customize
- **Real-time validation** with helpful error messages
- **Retry option** if validation fails

#### 3. Validation Features
- **Character limit enforcement** (30 chars for Direct DCRs, 64 for DCE-based)
- **Minimum length validation** (3 characters required)
- **Auto-trimming** of leading/trailing hyphens
- **Empty name prevention**
- **Helpful error messages** with retry prompts

### New Parameter: `-ConfirmDCRNames`

**Default:** `$true` (enabled by default)

Enable or disable interactive name confirmation prompts.

#### Usage Examples

**Default behavior (prompts enabled):**
```powershell
.\Run-DCRAutomation.ps1
```

**Explicitly enable prompts:**
```powershell
.\Run-DCRAutomation.ps1 -ConfirmDCRNames
```

**Disable prompts for automation/CI-CD:**
```powershell
.\Run-DCRAutomation.ps1 -ConfirmDCRNames:$false
```

**With specific mode:**
```powershell
.\Run-DCRAutomation.ps1 -NonInteractive -Mode DirectBoth -ConfirmDCRNames
```

### User Experience Flow

#### Step 1: Name Proposal
```
DCR Name Proposed: dcr-CSL-eastus
Note: Table name was abbreviated to meet 30 character limit
Table: CommonSecurityLog
Length: 17 characters (max: 30)

Accept this DCR name? [Y]es / [N]o (skip) / [E]dit:
```

#### Step 2: Edit Mode (if [E]dit selected)
```
Edit DCR name (max 30 chars)
Current value: dcr-CSL-eastus
Enter new name (or press Enter to keep current): dcr-CommonSecLog-eastus

DCR Name Proposed: dcr-CommonSecLog-eastus
```

#### Step 3: Validation
If name exceeds limits:
```
Custom name exceeds maximum length of 30 characters (provided: 35 chars).
Try again? [Y]es / [N]o (use proposed name):
```

### Confirmation Options

| Option | Action | Description |
|--------|--------|-------------|
| **[Y]es** | Accept | Use the proposed name and continue |
| **[N]o** | Skip | Skip this DCR/DCE (won't create it) |
| **[E]dit** | Edit | Customize the name with validation |

### Technical Implementation

#### New Function: `Confirm-ResourceName`
- **Location:** `core/Create-TableDCRs.ps1` (lines 1117-1206)
- **Features:**
  - Interactive prompt system
  - Validation loop with retry logic
  - Character limit enforcement
  - User-friendly error messages
  - Option to revert to proposed name

#### Integration Points
1. **DCR Name Confirmation** (line 2527-2541)
   - Activates after DCR name generation
   - Shows abbreviation warnings
   - Allows skip or customize

2. **DCE Name Confirmation** (line 2561-2576)
   - Only when `CreateDCE` is enabled
   - Same confirmation flow as DCR
   - Prevents orphaned DCEs

#### Parameter Flow
- Added to `Run-DCRAutomation.ps1` (line 33)
- Added to `Create-TableDCRs.ps1` (line 78)
- Passed through all script invocations
- Supports both interactive and non-interactive modes

### Benefits

#### For Interactive Use
- **Visual confirmation** of all resource names before deployment
- **Catch naming issues** early in the process
- **Customize names** to match organizational standards
- **Skip unwanted resources** without stopping entire script

#### For Automation
- **Disable with single parameter** for unattended execution
- **No breaking changes** to existing automation workflows
- **Backward compatible** with all existing scripts

#### For Compliance
- **Enforce naming conventions** interactively
- **Review before deployment** reduces errors
- **Audit trail** of naming decisions
- **Consistent resource naming** across environments

### Naming Rules Reference

#### DCR Naming Limits
- **Direct DCRs:** 30 characters maximum
- **DCE-based DCRs:** 64 characters maximum
- **Minimum:** 3 characters
- **Auto-trimmed:** Leading/trailing hyphens

#### Default Abbreviations (Direct DCRs)
| Table Name | Abbreviation |
|------------|--------------|
| CommonSecurityLog | CSL |
| SecurityEvent | SecEvt |
| WindowsEvent | WinEvt |
| Syslog | Syslog |
| DeviceEvents | DevEvt |
| BehaviorAnalytics | BehAna |
| Other tables | First 6 characters |

### Compatibility

#### Backward Compatibility
- **Enabled by default** for improved user experience
- **Can be disabled** for automation scenarios
- **No changes required** to existing scripts
- **Works with all DCR modes** (Direct, DCE-based, Private Link)

#### Requirements
- **Same prerequisites** as v1.1.0
- **PowerShell 5.1+** with Azure PowerShell modules
- **No additional dependencies**

### Use Cases

#### Scenario 1: Review Abbreviated Names
When Direct DCR limits cause abbreviation, users can review and adjust:
```
CommonSecurityLog → dcr-CSL-eastus
User can change to → dcr-CommSecLog-eastus
```

#### Scenario 2: Organizational Standards
Enforce custom naming conventions:
```
Proposed: dcr-Syslog-eastus
Custom: dcr-prod-syslog-eastus
```

#### Scenario 3: Skip Unwanted Tables
Process only needed resources:
```
Accept: SecurityEvent, Syslog
Skip: WindowsEvent, DeviceEvents
```

#### Scenario 4: Automation (No Prompts)
```powershell
# CI/CD Pipeline
.\Run-DCRAutomation.ps1 -NonInteractive -Mode DirectBoth -ConfirmDCRNames:$false
```

### Known Limitations

- **No batch rename:** Each DCR/DCE is confirmed individually
- **No preview mode:** Names are confirmed during execution
- **Console-only:** Requires interactive PowerShell session (unless disabled)

### Migration Notes

#### For Existing Users
- **Prompts now enabled by default** - expect interactive confirmation
- **Disable if needed** with `-ConfirmDCRNames:$false`
- **No configuration file changes** required

#### For Automation Scripts
Add `-ConfirmDCRNames:$false` to existing automation:
```powershell
# Before (still works, but prompts)
.\Run-DCRAutomation.ps1 -Mode DirectBoth

# After (no prompts)
.\Run-DCRAutomation.ps1 -Mode DirectBoth -ConfirmDCRNames:$false
```

### Future Enhancements (Planned)

- Configuration file for default naming patterns
- Batch rename capability
- Name preview mode before execution
- Custom validation rules
- Name template support

---

## Files Modified

### Scripts
- `Run-DCRAutomation.ps1` - Added `-ConfirmDCRNames` parameter
- `core/Create-TableDCRs.ps1` - Added confirmation function and integration

### Documentation
- `README.md` - Added parameter documentation
- `QUICK_START.md` - Added confirmation feature guide
- `RELEASE_NOTES/v1.2.0.md` - This file

---

## Upgrade Recommendation

**Recommended for all users.** This enhancement improves deployment safety and naming control without introducing breaking changes. Automation users should add `-ConfirmDCRNames:$false` to maintain unattended execution.

---

## Feedback

This feature was implemented based on user feedback. If you have suggestions for improvements or encounter issues, please open an issue in the repository.
